# ğŸŒ MÃ“DULO i18n-agent â€” RITMO

**VersiÃ³n**: 1.0.0
**Ãšltima actualizaciÃ³n**: 2025-10-05
**Budget tokens**: 1,024 - 2,048 tokens por operaciÃ³n

---

## ğŸ¯ PropÃ³sito

Agente especializado en completar y mantener traducciones bilingÃ¼es (EN/ES) siguiendo el protocolo establecido en `docs/BILINGUAL_GUIDE.md`.

**Responsabilidades**:
- Completar traducciones ES pendientes (140 strings â†’ 0)
- Validar consistencia bilingÃ¼e
- Verificar layouts con textos largos
- Regenerar archivos de localizaciÃ³n

**Responsabilidades NO incluidas**:
- âŒ Modificar lÃ³gica de negocio
- âŒ Cambiar estructura de archivos ARB
- âŒ Traducciones automÃ¡ticas sin revisiÃ³n humana

---

## ğŸ“‹ Protocolo de OperaciÃ³n

### **Ciclo completo (Gather â†’ Plan â†’ Act â†’ Verify â†’ Commit)**

#### 1. **Gather** (Recuperar contexto)
```bash
# Leer archivos obligatorios
Read: lib/l10n/app_en.arb         # Master (100% completo)
Read: lib/l10n/app_es.arb         # Target (71% completo)
Read: docs/BILINGUAL_GUIDE.md     # Protocolo bilingÃ¼e

# Opcional (solo si necesario)
Read: lib/generated/l10n/app_localizations.dart
```

**Budget tokens**: 512 tokens (archivos pequeÃ±os)

#### 2. **Plan** (Identificar trabajo)
```json
{
  "missing_keys": ["habitLimit", "habitLimitReached", "upgradeToPremium"],
  "total_missing": 3,
  "estimated_tokens": 1024,
  "batch_size": 10
}
```

**Budget tokens**: 256 tokens (anÃ¡lisis)

#### 3. **Act** (Generar traducciones)
```dart
// Reglas estrictas:
// 1. NO traducir literalmente, adaptar al contexto
// 2. Mantener placeholders: {count}, {points}, {streak}
// 3. Respetar tone: formal/informal segÃºn clave
// 4. Verificar longitud (max 2x inglÃ©s)

// Ejemplo:
// EN: "You've reached the limit of {count} free habits"
// ES: "Has alcanzado el lÃ­mite de {count} hÃ¡bitos gratuitos"
//     âŒ MAL: "Has alcanzado el lÃ­mite de {count} costumbres gratis"
//     âœ… BIEN: "Has alcanzado el lÃ­mite de {count} hÃ¡bitos gratuitos"
```

**Budget tokens**: 768 tokens (generaciÃ³n)

#### 4. **Verify** (Validar cambios)
```bash
# Paso 1: Regenerar traducciones
flutter gen-l10n

# Paso 2: Verificar compilaciÃ³n
flutter analyze

# Paso 3: Ejecutar tests (si aplica)
flutter test test/l10n_test.dart

# Paso 4: Validar visualmente (manual)
# - Cambiar idioma a ES
# - Verificar layouts no se rompan
```

**Output esperado**:
```json
{
  "flutter_gen_l10n": "success",
  "errors": 0,
  "warnings": 0,
  "translations_added": 3,
  "file": "lib/l10n/app_es.arb"
}
```

**Budget tokens**: 256 tokens (verificaciÃ³n)

#### 5. **Commit/PR** (Crear cambios)
```bash
# Crear branch
git checkout -b claude/i18n-batch-<nÃºmero>

# Stage changes
git add lib/l10n/app_es.arb
git add lib/generated/l10n/app_localizations_es.dart

# Commit con formato
git commit -m "i18n: Add Spanish translations for <feature>

Added translations:
- habitLimit
- habitLimitReached
- upgradeToPremium

Total: 3/140 strings completed

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# Crear PR
gh pr create --title "i18n: Add Spanish translations batch #<nÃºmero>" \
  --body "$(cat <<'EOF'
## Summary
Completed Spanish translations for <feature> following BILINGUAL_GUIDE.md protocol.

### Translations added (3)
- `habitLimit`: "LÃ­mite de hÃ¡bitos"
- `habitLimitReached`: "Has alcanzado el lÃ­mite de {count} hÃ¡bitos gratuitos"
- `upgradeToPremium`: "Actualizar a Premium"

### Testing
- [x] `flutter gen-l10n`: Success
- [x] `flutter analyze`: 0 errors
- [x] Visual validation: Layouts OK
- [x] Changed language to ES and verified

### Progress
- **Before**: 71% complete (140 strings pending)
- **After**: 71.6% complete (137 strings pending)

---
ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

**Budget tokens**: 512 tokens (PR creation)

---

## ğŸ¯ Budget tokens por tarea

| Tarea | Budget | JustificaciÃ³n |
|-------|--------|---------------|
| Simple (1-5 strings) | 1,024 | TraducciÃ³n directa |
| Medium (6-15 strings) | 2,048 | TraducciÃ³n + validaciÃ³n contexto |
| Large (16-30 strings) | 4,096 | TraducciÃ³n + validaciÃ³n layout + tests |
| Full audit (140 strings) | **NO PERMITIDO** | Dividir en batches de 10-15 |

**Estrategia recomendada**: Batches de 10-15 strings (2,048 tokens cada uno)

---

## ğŸ“Š Output JSON estandarizado

```json
{
  "task": "i18n-translation",
  "status": "success",
  "translations_added": 10,
  "file": "lib/l10n/app_es.arb",
  "flutter_gen_l10n": "success",
  "flutter_analyze": {
    "errors": 0,
    "warnings": 267,
    "baseline_ok": true
  },
  "tests_run": true,
  "tests_passed": 1,
  "tests_failed": 0,
  "visual_validation": true,
  "pr_created": "https://github.com/NoSFeR88/habito-pro-flutter/pull/4",
  "progress": {
    "before_percent": 71.0,
    "after_percent": 73.1,
    "strings_remaining": 130
  },
  "tokens_consumed": 1847,
  "duration_seconds": 45
}
```

---

## âœ… Checklist de calidad

Antes de crear PR, verificar:

- [ ] âœ… Traducciones agregadas a `app_es.arb`
- [ ] âœ… Placeholders preservados (`{count}`, `{points}`, etc.)
- [ ] âœ… Tone consistente con claves existentes
- [ ] âœ… Longitud razonable (max 2x inglÃ©s)
- [ ] âœ… `flutter gen-l10n` ejecutado sin errores
- [ ] âœ… `flutter analyze` dentro del baseline (303 warnings)
- [ ] âœ… Tests pasan (si existen tests l10n)
- [ ] âœ… ValidaciÃ³n visual en espaÃ±ol OK
- [ ] âœ… Commit message sigue convenciÃ³n
- [ ] âœ… PR incluye progress metrics

---

## ğŸš¨ Casos especiales

### **Plurales**
```json
// app_en.arb
"habitCount": "{count, plural, =0{No habits} =1{1 habit} other{{count} habits}}",

// app_es.arb
"habitCount": "{count, plural, =0{Sin hÃ¡bitos} =1{1 hÃ¡bito} other{{count} hÃ¡bitos}}"
```

### **Fechas y formatos**
```json
// NO hardcodear formatos
// âŒ MAL
"dateFormat": "DD/MM/YYYY"

// âœ… BIEN - Usar DateFormat de intl
// En cÃ³digo Dart:
DateFormat.yMMMd(Localizations.localeOf(context).languageCode).format(date)
```

### **Textos largos (multiline)**
```json
// app_en.arb
"onboardingWelcome": "Welcome to RITMO!\n\nTrack your habits and build better routines.",

// app_es.arb
"onboardingWelcome": "Â¡Bienvenido a RITMO!\n\nSigue tus hÃ¡bitos y construye mejores rutinas."
```

---

## ğŸ”„ Mantenimiento

### **AuditorÃ­a periÃ³dica**
```bash
# Buscar strings hardcoded
grep -r "Text('.*[a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃ‘Ã±]" lib/ --include="*.dart"

# Verificar cobertura
flutter gen-l10n
# Revisar output para encontrar mensajes sin traducir
```

### **ActualizaciÃ³n BILINGUAL_GUIDE.md**
Cuando se descubran nuevos patrones o anti-patrones, documentar en `docs/BILINGUAL_GUIDE.md`.

---

## ğŸ“ˆ KPIs de Ã©xito

- **Meta inmediata**: <50 strings sin traducir (de 140)
- **Meta final**: <10 strings sin traducir
- **Calidad**: 0 errores compilaciÃ³n por traducciones
- **Layouts**: 0 overflows por textos largos
- **Consistencia**: 100% uso de AppLocalizations (no hardcoded)

---

## ğŸ“ EscalaciÃ³n

Si encuentras:
- âŒ **Claves ambiguas**: Solicitar contexto al usuario
- âŒ **TÃ©rminos tÃ©cnicos**: Verificar consistencia con traducciones existentes
- âŒ **Layouts rotos**: Reportar en PR y marcar para revisiÃ³n manual

---

**FIN DEL MÃ“DULO i18n-agent v1.0**

> Para usar este agente: leer este archivo + ejecutar ciclo completo con budget 2,048 tokens
