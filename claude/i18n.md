# 🌍 MÓDULO i18n-agent — RITMO

**Versión**: 1.0.0
**Última actualización**: 2025-10-05
**Budget tokens**: 1,024 - 2,048 tokens por operación

---

## 🎯 Propósito

Agente especializado en completar y mantener traducciones bilingües (EN/ES) siguiendo el protocolo establecido en `docs/BILINGUAL_GUIDE.md`.

**Responsabilidades**:
- Completar traducciones ES pendientes (140 strings → 0)
- Validar consistencia bilingüe
- Verificar layouts con textos largos
- Regenerar archivos de localización

**Responsabilidades NO incluidas**:
- ❌ Modificar lógica de negocio
- ❌ Cambiar estructura de archivos ARB
- ❌ Traducciones automáticas sin revisión humana

---

## 📋 Protocolo de Operación

### **Ciclo completo (Gather → Plan → Act → Verify → Commit)**

#### 1. **Gather** (Recuperar contexto)
```bash
# Leer archivos obligatorios
Read: lib/l10n/app_en.arb         # Master (100% completo)
Read: lib/l10n/app_es.arb         # Target (71% completo)
Read: docs/BILINGUAL_GUIDE.md     # Protocolo bilingüe

# Opcional (solo si necesario)
Read: lib/generated/l10n/app_localizations.dart
```

**Budget tokens**: 512 tokens (archivos pequeños)

#### 2. **Plan** (Identificar trabajo)
```json
{
  "missing_keys": ["habitLimit", "habitLimitReached", "upgradeToPremium"],
  "total_missing": 3,
  "estimated_tokens": 1024,
  "batch_size": 10
}
```

**Budget tokens**: 256 tokens (análisis)

#### 3. **Act** (Generar traducciones)
```dart
// Reglas estrictas:
// 1. NO traducir literalmente, adaptar al contexto
// 2. Mantener placeholders: {count}, {points}, {streak}
// 3. Respetar tone: formal/informal según clave
// 4. Verificar longitud (max 2x inglés)

// Ejemplo:
// EN: "You've reached the limit of {count} free habits"
// ES: "Has alcanzado el límite de {count} hábitos gratuitos"
//     ❌ MAL: "Has alcanzado el límite de {count} costumbres gratis"
//     ✅ BIEN: "Has alcanzado el límite de {count} hábitos gratuitos"
```

**Budget tokens**: 768 tokens (generación)

#### 4. **Verify** (Validar cambios)
```bash
# Paso 1: Regenerar traducciones
flutter gen-l10n

# Paso 2: Verificar compilación
flutter analyze

# Paso 3: Ejecutar tests (si aplica)
flutter test test/l10n_test.dart

# Paso 4: Validar visualmente (manual)
# - Cambiar idioma a ES
# - Verificar layouts no se rompan
```

**Output esperado**:
```json
{
  "flutter_gen_l10n": "success",
  "errors": 0,
  "warnings": 0,
  "translations_added": 3,
  "file": "lib/l10n/app_es.arb"
}
```

**Budget tokens**: 256 tokens (verificación)

#### 5. **Commit/PR** (Crear cambios)
```bash
# Crear branch
git checkout -b claude/i18n-batch-<número>

# Stage changes
git add lib/l10n/app_es.arb
git add lib/generated/l10n/app_localizations_es.dart

# Commit con formato
git commit -m "i18n: Add Spanish translations for <feature>

Added translations:
- habitLimit
- habitLimitReached
- upgradeToPremium

Total: 3/140 strings completed

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# Crear PR
gh pr create --title "i18n: Add Spanish translations batch #<número>" \
  --body "$(cat <<'EOF'
## Summary
Completed Spanish translations for <feature> following BILINGUAL_GUIDE.md protocol.

### Translations added (3)
- `habitLimit`: "Límite de hábitos"
- `habitLimitReached`: "Has alcanzado el límite de {count} hábitos gratuitos"
- `upgradeToPremium`: "Actualizar a Premium"

### Testing
- [x] `flutter gen-l10n`: Success
- [x] `flutter analyze`: 0 errors
- [x] Visual validation: Layouts OK
- [x] Changed language to ES and verified

### Progress
- **Before**: 71% complete (140 strings pending)
- **After**: 71.6% complete (137 strings pending)

---
🤖 Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

**Budget tokens**: 512 tokens (PR creation)

---

## 🎯 Budget tokens por tarea

| Tarea | Budget | Justificación |
|-------|--------|---------------|
| Simple (1-5 strings) | 1,024 | Traducción directa |
| Medium (6-15 strings) | 2,048 | Traducción + validación contexto |
| Large (16-30 strings) | 4,096 | Traducción + validación layout + tests |
| Full audit (140 strings) | **NO PERMITIDO** | Dividir en batches de 10-15 |

**Estrategia recomendada**: Batches de 10-15 strings (2,048 tokens cada uno)

---

## 📊 Output JSON estandarizado

```json
{
  "task": "i18n-translation",
  "status": "success",
  "translations_added": 10,
  "file": "lib/l10n/app_es.arb",
  "flutter_gen_l10n": "success",
  "flutter_analyze": {
    "errors": 0,
    "warnings": 267,
    "baseline_ok": true
  },
  "tests_run": true,
  "tests_passed": 1,
  "tests_failed": 0,
  "visual_validation": true,
  "pr_created": "https://github.com/NoSFeR88/habito-pro-flutter/pull/4",
  "progress": {
    "before_percent": 71.0,
    "after_percent": 73.1,
    "strings_remaining": 130
  },
  "tokens_consumed": 1847,
  "duration_seconds": 45
}
```

---

## ✅ Checklist de calidad

Antes de crear PR, verificar:

- [ ] ✅ Traducciones agregadas a `app_es.arb`
- [ ] ✅ Placeholders preservados (`{count}`, `{points}`, etc.)
- [ ] ✅ Tone consistente con claves existentes
- [ ] ✅ Longitud razonable (max 2x inglés)
- [ ] ✅ `flutter gen-l10n` ejecutado sin errores
- [ ] ✅ `flutter analyze` dentro del baseline (303 warnings)
- [ ] ✅ Tests pasan (si existen tests l10n)
- [ ] ✅ Validación visual en español OK
- [ ] ✅ Commit message sigue convención
- [ ] ✅ PR incluye progress metrics

---

## 🚨 Casos especiales

### **Plurales**
```json
// app_en.arb
"habitCount": "{count, plural, =0{No habits} =1{1 habit} other{{count} habits}}",

// app_es.arb
"habitCount": "{count, plural, =0{Sin hábitos} =1{1 hábito} other{{count} hábitos}}"
```

### **Fechas y formatos**
```json
// NO hardcodear formatos
// ❌ MAL
"dateFormat": "DD/MM/YYYY"

// ✅ BIEN - Usar DateFormat de intl
// En código Dart:
DateFormat.yMMMd(Localizations.localeOf(context).languageCode).format(date)
```

### **Textos largos (multiline)**
```json
// app_en.arb
"onboardingWelcome": "Welcome to RITMO!\n\nTrack your habits and build better routines.",

// app_es.arb
"onboardingWelcome": "¡Bienvenido a RITMO!\n\nSigue tus hábitos y construye mejores rutinas."
```

---

## 🔄 Mantenimiento

### **Auditoría periódica**
```bash
# Buscar strings hardcoded
grep -r "Text('.*[a-zA-ZáéíóúÑñ]" lib/ --include="*.dart"

# Verificar cobertura
flutter gen-l10n
# Revisar output para encontrar mensajes sin traducir
```

### **Actualización BILINGUAL_GUIDE.md**
Cuando se descubran nuevos patrones o anti-patrones, documentar en `docs/BILINGUAL_GUIDE.md`.

---

## 📈 KPIs de éxito

- **Meta inmediata**: <50 strings sin traducir (de 140)
- **Meta final**: <10 strings sin traducir
- **Calidad**: 0 errores compilación por traducciones
- **Layouts**: 0 overflows por textos largos
- **Consistencia**: 100% uso de AppLocalizations (no hardcoded)

---

## 📞 Escalación

Si encuentras:
- ❌ **Claves ambiguas**: Solicitar contexto al usuario
- ❌ **Términos técnicos**: Verificar consistencia con traducciones existentes
- ❌ **Layouts rotos**: Reportar en PR y marcar para revisión manual

---

**FIN DEL MÓDULO i18n-agent v1.0**

> Para usar este agente: leer este archivo + ejecutar ciclo completo con budget 2,048 tokens
